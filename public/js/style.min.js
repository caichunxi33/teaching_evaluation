!function(){function e(e,s,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){console.log("xhr.readyState: ",n.readyState),4===n.readyState?200===n.status?t(null,n.responseText):(console.log("There was a problem with the request"),t(new Error("There was a problem with the request"))):console.log("still not ready...")},n.open("POST",e,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(s))}function s(){console.log("$message.scrollHeight: ",u.scrollHeight),u.scrollTop=u.scrollHeight}function t(){r.innerText="评教中...",r.setAttribute("disabled",!0)}function n(){r.innerText="一键评教",r.removeAttribute("disabled")}function a(){m.className=m.className.replace(/(hidden)/,""),console.log("$container.className: ",m.className),m.className+=" visible"}function i(){m.className=m.className.replace(/(visible)/,""),m.className+=" hidden"}function l(){u.className=u.className.replace(/message-border/,""),u.className=u.className.replace(/message-z-index/,""),g.className=g.className.replace(/visible/,""),g.className+=" hidden"}function c(){u.className+=" message-border",u.className+=" visible message-z-index",g.className=g.className.replace(/hidden/,"")}var r=document.getElementById("btn"),o=document.getElementById("number"),d=document.getElementById("password"),m=document.getElementById("container"),u=document.getElementById("message"),v=document.getElementById("messageList"),g=document.getElementById("close-message"),f=document.getElementById("title");g.addEventListener("click",function(e){v.innerHTML="",l(),a()}),r.addEventListener("click",function(l){console.log("$btn click"),l.defaultPrevented?l.defaultPrevented():window.event.returnValue=!1;var r=o.value,m=d.value;if(!r)return v.innerHTML+='<div class="text-success">[提示] 请输入学号 </div>',!1;if(!m)return v.innerHTML+='<div class="text-success">[提示] 请输入密码 </div>',!1;var u="/api/evaluationList",g={number:r,password:m};console.log("data: ",g),t(),f.innerText="你懂的",v.innerHTML="",v.innerHTML+='<div class="text-info">[提示] 模拟登录教务系统...</div>',e(u,g,function(t,l){const r=JSON.parse(l);if(console.log("err: ",t),console.log("res: ",l),console.log("parsed: ",r),t)return a(),v.innerHTML+='<div class="text-info">[失败] 服务器错误，请重试</div>',!1;if(0===r.code){v.innerHTML+='<div class="text-success">[成功] 模拟登录成功</div>',v.innerHTML+='<div class="text-info">[提示] 开始教学评估</div>',v.innerHTML+='<div class="text-info">[提示] 获取需要评估的老师列表...</div>',i(),c(),n();var o=r.evaluationList;v.innerHTML+='<div class="text-success">[成功] 共 '+o.length+" 名需要评估的老师 </div>";var d=r.cookie,m=o.filter(function(e){return"否"===e.isEvalute&&e});if(console.log("list: ",m),0===m.length&&(v.innerHTML+='<div class="text-info">[提示] 所有老师都已评估完成，无需要再次评教</div>',v.innerHTML+='<div class="text-info">[提示] 即将展示教学评估列表...</div>',s()),o.forEach(function(e){"是"===e.isEvalute&&(console.log("item: ",e),v.innerHTML+='<div class="text-info">[已评估] '+e.teacherName+" "+e.className+"</div>",s())}),0===m.length)return!1;v.innerHTML+='<div class="text-info">[提示] 开始教学评估...</div>',s(),m.map(function(n){if(console.log("item: ",n),"否"===n.isEvalute){var a="/api/evaluate",i={wjbm:n.wjbm,bpr:n.bpr,pgnr:n.pgnr,cookie:d,teacherName:n.teacherName,className:n.className,isEvalute:n.isEvalute,type:n.type};e(a,i,function(e,a){if(t)return v.innerHTML+='<div class="text-failed">[失败] '+n.teacherName+" "+n.className+" 评估失败</div>",s(),!1;var i=JSON.parse(a);console.log("parsedEvaluate: ",i),0===i.code?(v.innerHTML+='<div class="text-success">[成功]  '+i.teacher.teacherName+" "+i.teacher.className+" 评估成功</div>",s()):(v.innerHTML+='<div class="text-failed">[失败] '+i.teacher.teacherName+" "+i.teacher.className+"</div>",s())})}})}else n(),a(),f.innerHTML="&nbsp;",v.innerHTML+='<div class="text-failed">[失败] '+r.message+"</div>"})})}();